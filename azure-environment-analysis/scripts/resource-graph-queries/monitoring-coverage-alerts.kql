// Monitoring Coverage - Alert Rules
// Purpose: Inventory all alert rules targeting integration resources
// Usage: Run via Azure Resource Graph Explorer or Azure MCP Server
//
// Returns: Metric alerts and scheduled query rules for integration resources

resources
| where type == 'microsoft.insights/metricalerts' 
    or type == 'microsoft.insights/scheduledqueryrules'
| extend
    targetResourceType = tostring(split(properties.scopes[0], '/')[6]),
    targetResourceName = tostring(split(properties.scopes[0], '/')[8]),
    severity = properties.severity,
    enabled = properties.enabled
| where targetResourceType in~ (
    'microsoft.logic',
    'microsoft.servicebus',
    'microsoft.keyvault',
    'microsoft.web',
    'microsoft.apimanagement',
    'microsoft.storage',
    'microsoft.eventgrid',
    'microsoft.eventhub'
)
| project
    alertName = name,
    resourceGroup,
    alertType = case(
        type == 'microsoft.insights/metricalerts', 'Metric Alert',
        type == 'microsoft.insights/scheduledqueryrules', 'Log Alert',
        'Other'
    ),
    targetResourceType,
    targetResourceName,
    severity,
    enabled
| order by targetResourceType asc, alertName asc
