// Networking Topology - VNet Integration
// Purpose: Identify Function Apps and Logic Apps Standard with VNet integration
// Usage: Run via Azure Resource Graph Explorer or Azure MCP Server
//
// Returns: Apps with their VNet integration status and subnet information

resources
| where type == 'microsoft.web/sites'
| where kind contains 'functionapp' or kind contains 'workflowapp'
| extend 
    vnetIntegration = isnotnull(properties.virtualNetworkSubnetId),
    subnetId = properties.virtualNetworkSubnetId,
    vnetName = iff(isnotnull(properties.virtualNetworkSubnetId), 
        tostring(split(properties.virtualNetworkSubnetId, '/')[8]), ''),
    subnetName = iff(isnotnull(properties.virtualNetworkSubnetId), 
        tostring(split(properties.virtualNetworkSubnetId, '/')[10]), ''),
    resourceType = case(
        kind contains 'workflowapp', 'Logic App Standard',
        kind contains 'functionapp', 'Function App',
        'Other'
    )
| project
    name,
    resourceType,
    resourceGroup,
    vnetIntegration,
    vnetName,
    subnetName,
    location
| order by vnetIntegration asc, resourceType asc, name asc
