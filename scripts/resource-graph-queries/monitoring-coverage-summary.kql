// Monitoring Coverage - Summary by Resource Type
// Purpose: Get a count of resources that should have monitoring configured
// Usage: Run via Azure Resource Graph Explorer or Azure MCP Server
//
// Returns: Summary counts by resource type for monitoring gap analysis

resources
| where type in~ (
    'microsoft.logic/workflows',
    'microsoft.web/sites',
    'microsoft.servicebus/namespaces',
    'microsoft.keyvault/vaults',
    'microsoft.apimanagement/service',
    'microsoft.storage/storageaccounts',
    'microsoft.eventgrid/topics',
    'microsoft.eventhub/namespaces'
)
| where type != 'microsoft.web/sites' 
    or (type == 'microsoft.web/sites' and 
        (kind contains 'functionapp' or kind contains 'workflowapp'))
| extend resourceType = case(
    type == 'microsoft.logic/workflows', 'Logic App (Consumption)',
    type == 'microsoft.web/sites' and kind contains 'workflowapp', 'Logic App (Standard)',
    type == 'microsoft.web/sites' and kind contains 'functionapp', 'Function App',
    type == 'microsoft.servicebus/namespaces', 'Service Bus',
    type == 'microsoft.apimanagement/service', 'API Management',
    type == 'microsoft.keyvault/vaults', 'Key Vault',
    type == 'microsoft.storage/storageaccounts', 'Storage Account',
    type == 'microsoft.eventgrid/topics', 'Event Grid',
    type == 'microsoft.eventhub/namespaces', 'Event Hubs',
    'Other'
)
| summarize count() by resourceType
| order by count_ desc
